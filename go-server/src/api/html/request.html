<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAIS SCRUMLR</title>
</head>

<body>

    <h1>Join Board</h1>

    <input id="board-id" type="text" placeholder="board-id">
    <input id="user-id" type="text" placeholder="user-id">
    <button onclick="joinBoard()">Join</button>

    <ul id="events"></ul>

    <script>
        const events = document.getElementById("events")

        const joinBoard = () => {
            const boardID = document.getElementById("board-id").value
            const userID = document.getElementById("user-id").value
            fetch(`/boards/${boardID}/participants`, {
                method: 'POST',
                redirect: "manual"
            }).then(() => {
                const ws = new WebSocket(`ws:\/\/localhost:8080/boards/${boardID}/requests/${userID}`)
                ws.onopen = (evt) => {
                    console.log("connected", evt)
                }
                ws.onclose = (evt) => {
                    console.log("closed", evt)
                }
                ws.onerror = (evt) => console.log('ERROR: ', evt)
                ws.onmessage = (evt) => {
                    console.log("received", evt)
                    const li = document.createElement("li")
                    li.innerText = evt.data
                    events.append(li)
                }
            })
        }
    </script>

</body>

</html>